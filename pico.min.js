(function(e,r,t){"object"==typeof process&&process.argv&&process.argv[2]&&(ajax=function(e,r,n,i,a,o){var s=t("fs");s.readFile(r,{encoding:"utf8"},function(e,r){return e?a(e,2,null,o):void a(null,4,r,o)})},loader(process.argv[2],dummyCB)),define("pico/obj",function(){var r=["object","function"];return{extend:function(e,t,n){var i=r.indexOf(typeof e);if(-1===i)return t;var a=r.indexOf(typeof t);if(-1===a)return e;if(1===a&&a===i)return t;n=n||{};var o,s,u=n.tidy,c=arguments.callee;if(1===a||void 0===t.length)for(o in t)s=t[o],void 0===s&&u||(e[o]=c(e[o],s,n));else if(n.mergeArr){var l,f,d={};for(l=0,f=e.length;f>l;l++)void 0===(s=e[l])&&u||(d[s]=s);for(l=0,f=t.length;f>l;l++)void 0===(s=t[l])&&u||(d[s]=s);e=[];for(o in d)e.push(d[o])}else e=t;return e},"extends":function(e,r,t){for(var n,i=this.extend,a=0;n=r[a];a++)e=i(e,n,t);return e},parseInts:function(e){for(var r=0,t=e.length;t>r;r++)e[r]=parseInt(e[r]);return e},pluck:function(e,r){var t=[];if(e.length){var n,i,a,o,s,u={};for(a=0,o=e.length;o>a;a++)n=e[a],n&&(i=n[r],void 0!==i&&(u[i]=i));for(s in u)t.push(u[s])}return t},strip:function(e,r){if(e.length)for(var t,n=0;t=e[n];n++)t[r]=void 0;return e},keyValues:function(e,r,t){for(var n,i={},a=0;n=e[a];a++)i[n[r]]=n[t];return i},map:function(e,r,t,n){for(var i,a={},o=0;i=e[o];o++)a[r[i[t]]]=i[n];return a},replace:function(e,r,t){for(var n,i=0;n=e[i];i++)n[t]=r[n[t]];return e},group:function(e,r,t){for(var n,i,a={},o=0;i=e[o];o++)n=i[t],n=r[n]||n,a[n]=a[n]||[],a[n].push(i);return a},values:function(e,r){for(var t,n=[],i=0;t=e[i];i++)n.push(r[t]);return n},merge:function(e,r){if(!e)return r;if(!r)return e;for(var t,n=0,i=Object.keys(r);t=i[n];n++)e[t]=r[t];return e},mergeByKey:function(r,t,n){var i,a=e.exports.merge,o={},s=[];if(r)for(var u,c=0;u=r[c];c++)i=u[n],void 0!==i&&(o[i]=u);if(t)for(var l,f=0;l=t[f];f++)i=l[n],void 0!==i&&(u=o[i],o[i]=u?a(u,l):l);for(i in o)s.push(o[i]);return s},filter:function(e,r,t){for(var n,i,a=[],o=0;i=e[o];o++)n=i[t],n&&-1===r.indexOf(n)&&a.push(i);return a},insert:function(r,t){for(var n,i=e.exports.merge,a=0;n=r[a];a++)n=i(n,t);return r}}}),define("pico/str",function(){var e=(Math.ceil,Math.random),r=function(e,r){var t=r[0];return"["+(t.getFunctionName()||t.getTypeName()+"."+t.getMethodName())+"@"+t.getFileName()+":"+t.getLineNumber()+":"+t.getColumnNumber()+"]"};return{codec:function(e,r){for(var t,n="",i=0;t=r.charCodeAt(i);i++)n+=String.fromCharCode(t^e);return n},hash:function(e){for(var r,t=0,n=0;r=e.charCodeAt(n);n++)t=(t<<5)-t+r,t&=t;return t},rand:function(){return e().toString(36).substr(2)},tab:function(e,r,t){var n="",i=r-e.length;if(!i||1>i)return n;t=t||" ";for(var a=0;i>a;a++)n+=t;return n},log:function(){var e=Error.prepareStackTrace,t=Error.stackTraceLimit;Error.prepareStackTrace=r,Error.stackTraceLimit=1;var n=new Error;Error.captureStackTrace(n,arguments.callee);var i=[(new Date).toISOString(),n.stack];console.log.apply(console,i.concat(Array.prototype.slice.call(arguments))),Error.prepareStackTrace=e,Error.stackTraceLimit=t},error:function(){var e=Error.stackTraceLimit;Error.stackTraceLimit=4;var r=new Error;Error.captureStackTrace(r,arguments.callee);var t=[(new Date).toISOString()];t=t.concat(Array.prototype.slice.call(arguments)),t.push("\n"),console.error.apply(console,t.concat(r.stack)),Error.stackTraceLimit=e}}}),define("pico/test",function(){var e=pico["export"]("pico/str"),r="undefined"==typeof t?JSON.stringify:t("util").inspect;return{ensure:function(t,n){n(function(n,i){return n?console.error(t+":"+e.tab(t,100,"-")+n):void console.log(t+":"+e.tab(t,100,".")+r(i,{colors:!0}))})}}}),define("pico/time",function(){var e=(Math.max,Math.min,864e5),r=36e5,t=6e4,n=1e3,i=function(e,r,t){return r?void 0:e};return{deltaToNext:function(e,i,a,o,s){i=i||0,a=a||0,o=o||0,s=s||0;var u=new Date,c=u.getTime()%r-(a*t+o*n+s),l=i+24*e-u.getHours();return l*r-c},timeOfNext:function(e,r,t,n,i){var a=this.deltaToNext(e,r,t,n,i),o=new Date(Date.now()+a);return o.getTime()},parse:function(e){var r=e.split(" ");if(r.length<6)return 0;var t=parseAtom(r[0],0,59);if(null==t)return 0;var n=parseAtom(r[1],0,23);if(null==n)return 0;var i=parseAtom(r[2],1,31);if(null==i)return 0;var a=parseAtom(r[3],1,12);if(null==a)return 0;var o=parseAtom(r[4],0,6);if(null==o)return 0;var s=parseAtom(r[5],1970,3e3);return null==s?0:[t,n,i,a,o,s]},nearest:function(n,a,o,s,u,c){var l=new Date,f=i(l.getFullYear(),c,0),d=l.getDay(),h=i(d,u,7),p=l.getMonth(),v=l.getDate(),g=i(l.getHours(),a,24),m=i(l.getMinutes(),n,60);d===h?(p=i(p,s,12),v=i(v,o,new Date(f,p-1,0).getDate())):v+=h-d,p>12&&(f+=Floor(p/12),p%=12);var b=new Date(f,p).getTime();return b+=v*e,b+=g*r,b+=m*t}}}),define("pico/web",function(e,r,t,n,i,a){function o(e){return e.url?(S(this,e),this.reqId=1+u(1e3*c()),this.inbox=[],this.outbox=[],this.uploads=[],this.callbacks={},this.acks=[],this.reqs=[],this.resEndPos=0,this.head=null,this.body=[],this.currPT=f,this.serverTime=0,this.serverTimeAtClient=0,void(this.beatId=0)):console.error("url is not set")}var s=Math.abs,u=Math.floor,c=Math.random,l="ack",f=1,d=2,h=!0,p=function(e){e&&console.error(e)},v=function(e,r,t){e.append(r,t)},g=function(e,r,t){e[r]=t},m=function(e,r){r=r||p,ajax("get",e.url,null,null,function(t,n,i){if(4===n){if(t)return r(t);var a=parseInt(i);if(isNaN(a))return r("invalid timesync response");e.serverTime=a,e.serverTimeAtClient=Date.now(),e.beatId=setInterval(y,e.beatRate,e),r()}})},b=function(e,r,t,n){if(e){if(4!==r)return;var i={error:"Network error"};if(t){try{i=JSON.parse(t)}catch(a){return console.error(a)}return}for(var o,u,c,c,h=n.reqs,p=n.delimiter,v=0,g=h.length;g>v;v++)if(c=h[v])try{if(o=JSON.parse(c.split(p)[0]).reqId,u=n.callbacks[o],!u)continue;delete n.callbacks[o],u(i.error)}catch(a){console.error(a);continue}return h.length=0,m(n)}switch(r){case 2:n.head=null,n.currPT=f;break;case 3:break;case 4:n.beatId||(n.beatId=setInterval(y,n.beatRate,n))}var b,k=n.resEndPos,S=-1,p=n.delimiter,T=p.length,I=n.body;try{for(;;){if(S=t.indexOf(p,k),-1===S)break;switch(n.currPT){case f:n.head=JSON.parse(t.substring(k,S)),I.length=0,n.currPT=d;break;case d:I.push(t.substring(k,S))}if(b=n.head,b&&b.len===I.length){if(n.currPT=f,b.resId&&n.request(l,{resId:b.resId}),!b.reqId)return void console.error("incomplete response header: "+JSON.stringify(b));if(n.cullAge&&n.cullAge<s(n.getServerTime()-b.date))return void console.error("invalid server time: "+JSON.stringify(b)+" "+s(n.getServerTime()-b.date));if(n.secretKey&&I.length){for(var x=CryptoJS.algo.HMAC.create(CryptoJS.algo.MD5,n.secretKey+b.date),v=0,g=I.length;g>v;v++)x.update(I[v]);if(b.key!==x.finalize().toString(CryptoJS.enc.Base64))return void console.error("invalid server key: "+JSON.stringify(b))}b.len&&(b.data=JSON.parse(I[0],function(e,r){switch(e){case"json":return JSON.parse(I[r]);case"blob":return I[r];default:return r}})),n.inbox.push(b),n.head=null}k=S+T}}catch(a){console.error(a)}n.resEndPos=k},y=function(e){if(e.inbox.length)for(var r,t,n,i=e.inbox,a=e.callbacks;n=i.pop();)r=n.reqId,t=a[r],t&&(delete a[r],t(n.error,n.data));if(h&&(e.uploads.length||e.outbox.length||e.acks.length)){if(e.resEndPos=0,e.uploads.length)ajax("post",e.url,e.uploads.shift(),null,b,e);else{var o=e.reqs=e.acks.concat(e.outbox);e.acks.length=e.outbox.length=0,ajax("post",e.url,o.join(e.delimiter)+e.delimiter,null,b,e)}return clearInterval(e.beatId),void(e.beatId=0)}},k=function(e,r,t,n){n=n||"";for(var i,a,o,s,u=t instanceof FormData?v:g,c=e.baseURI,l=0,f=e.elements;s=f[l];l++)if(s.hasAttribute("name"))if(i=s.hasAttribute("type")?s.getAttribute("type").toUpperCase():"TEXT","FILE"===i)for(a=0,o=s.files.length;o>a;u(t,n+s.name,s.files[a++]));else("RADIO"!==i&&"CHECKBOX"!==i||s.checked)&&u(t,n+s.name,s.value);for(var d in r)u(t,n+d,r[d]);return c=c.substring(0,c.lastIndexOf("/")+1),e.action.substr(c.length)},S=function(e,r){e.url=r.url||e.url,e.secretKey=r.secretKey||e.secretKey,e.cullAge=r.cullAge||e.cullAge||0,e.delimiter=r.delimiter?JSON.stringify(r.delimiter):e.delimiter||JSON.stringify(["&"]),e.beatRate=!r.beatRate||r.beatRate<100?e.beatRate||5e3:r.beatRate},T=function(e){e.resEndPos=e.outbox.length=e.acks.length=0,e.currPT=f};return o.prototype={reconnect:function(e,r){S(this,e),T(this),m(this,function(e){r(e,this)})},submit:function(e,r,t){if(!("undefined"!=typeof window&&e&&e instanceof HTMLFormElement))return console.error("No HTMLFormElement submitted");var n=0;t&&(n=this.reqId++,this.callbacks[n]=t);var i=new FormData;i.append("api",k(e,r,i,"data/")),i.append("reqId",n),this.uploads.push(i),this.beatId||(this.beatId=setInterval(y,this.beatRate,this))},request:function(e,r,t,n){switch(arguments.length){case 2:r instanceof Function&&(n=r,r=t=void 0);break;case 3:t instanceof Function&&(n=t,t=void 0);break;case 4:break;default:return console.error("wrong request params!")}if("undefined"!=typeof window&&r instanceof HTMLFormElement){var i={};e=k(r,t,i),r=i}else if(t)for(var a in t)r[a]=t[a];if(!e)return console.error("Missing api,  data["+JSON.stringify(r)+"]");var o=this.acks;if(e!==l&&(o=this.outbox,o.length)){var s=o.shift();-1===s.indexOf(e)&&o.unshift(s)}var u=0;n&&(u=this.reqId++,this.callbacks[u]=n);var c=[];if(r&&c.unshift(JSON.stringify(r,function(e,r){switch(e){case"json":return c.push(JSON.stringify(r));case"blob":return c.push(r);default:return r}})),c.length&&this.secretKey){for(var f=this.getServerTime(),d=CryptoJS.algo.HMAC.create(CryptoJS.algo.MD5,this.secretKey+f),h=0,p=c.length;p>h;h++)d.update(c[h]);c.unshift(JSON.stringify({api:e,reqId:u,len:c.length,date:f,key:d.finalize().toString(CryptoJS.enc.Base64)}))}else c.unshift(JSON.stringify({api:e,reqId:u,len:c.length}));o.push(c.join(this.delimiter)),this.beatId||(this.beatId=setInterval(y,this.beatRate,this))},getServerTime:function(){return this.serverTime+(Date.now()-this.serverTimeAtClient)}},{create:function(e,r){var t=new o(e);m(t,function(e){r(e,t)})},ajax:ajax,online:function(){h=!0},offline:function(){h=!1}}})}).apply(null,"undefined"==typeof window?[module,"exports",require]:[window,"pico"]);
//# sourceMappingURL=/var/node/pico/common/pico.min.js.map