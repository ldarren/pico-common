(function(e,r,t){var n,i,o=function(){},u=function(){arguments[arguments.length-1]()},a={run:o,build:o,reload:o,parse:o,define:o,"import":o,"export":o,env:o,ajax:o},s={"'":"&#039;","\n":"\\n","\r":"\\n"},c=function(e){return s[e]},l={},f={},p=".js",h=".json",d="pico.define('URL','FUNC')\n",g='"use strict";\n',v="//# sourceURL=",m="return arguments.callee.__proto__.apply(this,arguments)",y={},b={},S={},k=function(){return"undefined"==typeof requestAnimationFrame?function(e){return setTimeout(e,100)}:requestAnimationFrame}(),w=function(e){return e.substring(e.indexOf("{")+1,e.lastIndexOf("}"))},x=function(e){if(!e)return null;var r=e.lastIndexOf(".");return-1!==r&&-1===e.indexOf("/",r)?e.substr(r):null},T=function(e,r){return e.length?void O(e.shift(),function(t){return t?r(t):void T(e,r)}):r()},O=function(e,r){if(l[e])return r(null,l[e]);var t=x(e),i=e.indexOf("/"),o=y[-1===i?e:e.substr(0,i)];o||(i=-1,o=y["*"]||"");var u=-1===i?e:e.substr(i+1);o instanceof Function?o(u,function(t,n){return t?r(t):(l[e]=n,void r(null,n))}):n("get",o+u+(t?"":p),null,null,function(n,i,o){if(n)return r(n);if(4===i)switch(t||p){case p:return M(e,o,r);default:return r(null,I(e,o))}})},F=function(){return Function(m)},N=function(e,r){var t=l[e];return t?(setTimeout(r||o,0,null,t),t):r?O(e,r):l[e]=F()},D=function(e,r,t,n,i){i=i||a;var u=e?g+r+(b.live?"":v+e):r,s=function(e){return l[e]||t.push(e),l[e]},c=function(e){n.unshift(e),s(e)};try{var f=Function("exports","require","module","define","inherit","pico",u)}catch(p){return console.error(e,p.message)}return f.call({},{},s,{},o,c,i),f},I=function(e,r,t,n){var i=x(e)||p,u=S[i];switch(u&&(r=u(e,r)),i){case p:var a={exports:{}},s={},c=r.call(n?{}:s,a.exports,N,a,I,o,A)||a.exports;if(t&&(c.__proto__=t),s.load&&s.load(c),"function"==typeof s.update&&(f[e]=[s.update,c]),!e)return c;var d=l[e];return d?(d.prototype=c.prototype,d.__proto__=c,l[e]=d):l[e]=c;case h:try{return l[e]=JSON.parse(r)}catch(g){return console.error(e,g.message)}default:return l[e]=r}},M=function(e,r,t){if(t=t||o,l[e])return t(null,l[e]);var n=[],i=[],u=D(e,r,n,i);e&&(l[e]=F()),T(n,function(r){return r?t(r):void t(null,I(e,u,l[i[0]]))})},J=function(e){k(J);for(var r,t=0,n=Object.keys(f);r=f[n[t]];t++)r[0](r[1],e)},A=e[r]={run:function(e,r){A.ajax=n=e.ajax||n,y=e.paths||y,b=e.env||b,S=e.preprocessors||S;var t;for(var o in l)t=S[x(o)||p],t&&(l[o]=t(o,l[o]));(e.onLoad||u)(function(){M(e.name||null,w(r.toString()),function(e,r){return e?console.error(e):(r instanceof Function&&r(),i&&i(),void k(J))})})},build:function(e){var r=t("fs"),n=e.entry,u=e.output,a=e.exclude,s=I,l=function(e,t){t&&t.length&&(r.appendFileSync(e,r.readFileSync(t.shift())),r.appendFileSync(e,"\n"),l(e,t))},f=function(e,r){return e&&e.length?void O(e.shift(),function(t){f(e,r)}):r()};J=o,I=function(e,t,n){if(s(e,t,n,!0),e&&-1===a.indexOf(e))switch(x(e)||p){case p:return r.appendFileSync(u,d.replace("URL",e).replace("'FUNC'",t.toString()));case h:return r.appendFileSync(u,d.replace("URL",e).replace("FUNC",JSON.stringify(JSON.parse(t)).replace(/['\n\r]/g,c)));default:return r.appendFileSync(u,d.replace("URL",e).replace("FUNC",t.replace(/['\n\r]/g,c)))}},r.unlink(u,function(){l(u,e.deps),r.readFile(n,"utf8",function(t,o){if(t)return console.error(t);var s=D(null,o,[],[],A);-1===a.indexOf(n)&&(i=function(){r.appendFileSync(u,w(s.toString())),f(e.include,function(e){e&&console.error(e),process.exit()})})})})},reload:function(e,r,t){"function"==typeof r&&(t=r),t=t||o;var n=l[e];if(delete l[e],p!==(x(e)||p))return t(null,n);var i=function(r,i){return r?t(r):n?(n.prototype=i.prototype,n.__proto__=i,t(null,l[e]=n)):t(null,i)};"string"==typeof r?M(e,r,i):O(e,i)},parse:M,define:I,"import":t,"export":N,env:function(e){return b[e]}};"object"==typeof process&&(n=n||function(e,r,n,i,o,u){var a=t("fs").readFileSync(r,"utf8");return a?setImmediate(o,null,4,a,u):void setImmediate(o,"failed",2,null,u)}),I("pico/json",function(e,r,t,n,i,o){return{parse:function(e,r){return JSON.parse(e[0],function(t,n){switch(t[0]){case"$":if(r)return JSON.parse(e[n]);case"_":return e[n];default:return n}})},stringify:function(e,r){var t=[];return t.unshift(JSON.stringify(e,function(e,n){switch(e[0]){case"$":if(r)return t.push(JSON.stringify(n));case"_":return t.push(n);default:return n}})),t}}}),I("pico/obj",function(){var e=["object","function"];return{extend:function(r,t,n){var i=e.indexOf(typeof r);if(-1===i)return t;var o=e.indexOf(typeof t);if(-1===o)return r;if(1===o&&o===i)return t;n=n||{};var u,a,s=n.tidy,c=arguments.callee;if(1===o||void 0===t.length)for(u in t)a=t[u],void 0===a&&s||(r[u]=c(r[u],a,n));else if(n.mergeArr){var l,f,p={};for(l=0,f=r.length;f>l;l++)void 0===(a=r[l])&&s||(p[a]=a);for(l=0,f=t.length;f>l;l++)void 0===(a=t[l])&&s||(p[a]=a);r=[];for(u in p)r.push(p[u])}else r=t;return r},"extends":function(e,r,t){for(var n,i=this.extend,o=0;n=r[o];o++)e=i(e,n,t);return e},parseInts:function(e){for(var r=0,t=e.length;t>r;r++)e[r]=parseInt(e[r]);return e},pluck:function(e,r){var t=[];if(e.length){var n,i,o,u,a,s={};for(o=0,u=e.length;u>o;o++)n=e[o],n&&(i=n[r],void 0!==i&&(s[i]=i));for(a in s)t.push(s[a])}return t},strip:function(e,r){if(e.length)for(var t,n=0;t=e[n];n++)t[r]=void 0;return e},keyValues:function(e,r,t){for(var n,i={},o=0;n=e[o];o++)i[n[r]]=n[t];return i},map:function(e,r,t,n){for(var i,o={},u=0;i=e[u];u++)o[r[i[t]]]=i[n];return o},replace:function(e,r,t){for(var n,i=0;n=e[i];i++)n[t]=r[n[t]];return e},group:function(e,r,t){var n={};t=t||{};for(var i,o,u=0;i=e[u];u++)o=i[r],o=t[o]||o,n[o]=n[o]||[],n[o].push(i);return n},values:function(e,r){for(var t,n=[],i=0;t=r[i];i++)n.push(e[t]);return n},merge:function(e,r){if(!e)return r;if(!r)return e;for(var t,n=0,i=Object.keys(r);t=i[n];n++)e[t]=r[t];return e},mergeByKey:function(e,r,t){var n,i=this.merge,o={},u=[];if(e)for(var a,s=0;a=e[s];s++)n=a[t],void 0!==n&&(o[n]=a);if(r)for(var c,l=0;c=r[l];l++)n=c[t],void 0!==n&&(a=o[n],o[n]=a?i(a,c):c);for(n in o)u.push(o[n]);return u},filter:function(e,r,t){for(var n,i,o=[],u=0;i=e[u];u++)n=i[t],n&&-1===r.indexOf(n)&&o.push(i);return o},insert:function(e,r){for(var t,n=this.merge,i=0;t=e[i];i++)t=n(t,r);return e}}}),I("pico/str",function(){var e=(Math.ceil,Math.random),r=function(e,r){var t=r[0];return"["+(t.getFunctionName()||t.getTypeName()+"."+t.getMethodName())+"@"+t.getFileName()+":"+t.getLineNumber()+":"+t.getColumnNumber()+"]"},t=function(e){var r=e.search("[#:%]");switch(r){case-1:case 0:return e}return[e.substring(0,r),e.substr(r)]},n=function(e,r,i,o){var u=e.indexOf("/",r);return-1===u?(i.push(t(e.substring(r))),o(null,i)):(i.push(t(e.substring(r,u))),void n(e,u+1,i,o))},i=function(e,r,t){return e.length?void n(e.shift(),0,[],function(n,o){return n?t(n):(r.push(o),void i(e,r,t))}):t(null,r)},o=function(e,r,t,n,i){switch(e[0]){default:return e===r;case"%":i[e.substr(1)]=parseFloat(r);break;case":":i[e.substr(1)]=r;break;case"#":i[e.substr(1)]=t.slice(n).join("/")}return!0},u=function(e,r,t){if(e.length<r.length)return!1;for(var n,i,u=0,a=r.length;a>u;u++)if(i=r[u],n=e[u],Array.isArray(i)){if(0!==n.indexOf(i[0]))return!1;if(!o(i[1],n.substr(i[0].length),e,u,t))return!1}else if(!o(i,n,e,u,t))return!1;return e.splice(0,a),!0};return{codec:function(e,r){for(var t,n=0,i="";t=r.charCodeAt(n);n++)i+=String.fromCharCode(t^e);return i},hash:function(e){for(var r,t=0,n=0;r=e.charCodeAt(t);t++)n=31*n+r|0;return n},rand:function(){return e().toString(36).substr(2)},pad:function(e,r,t){return this.tab(e,r,t)+e},tab:function(e,r,t){return Array(r-String(e).length+1).join(t||"0")},compileRest:function(e,r){return r=r||[],-1===e.search("[|#:%]")?r:(i(e.split("|"),[e],function(e,t){if(e)throw e;r.push(t)}),r)},execRest:function(e,r,t){for(var n,i,o,a=e.split("/"),s=0;n=r[s];s++)if(u(a,n[1],t)){for(i=2;(o=n[i])&&u(a,o,t);i++);return n[0]}return null},log:function(){var e=Error.prepareStackTrace,t=Error.stackTraceLimit;Error.prepareStackTrace=r,Error.stackTraceLimit=1;var n=new Error;Error.captureStackTrace(n,arguments.callee);var i=[(new Date).toISOString(),n.stack];console.log.apply(console,i.concat(Array.prototype.slice.call(arguments))),Error.prepareStackTrace=e,Error.stackTraceLimit=t},error:function(){var e=Error.stackTraceLimit;Error.stackTraceLimit=4;var r=new Error;Error.captureStackTrace(r,arguments.callee);var t=[(new Date).toISOString()];t=t.concat(Array.prototype.slice.call(arguments)),t.push("\n"),console.error.apply(console,t.concat(r.stack)),Error.stackTraceLimit=e}}}),I("pico/test",function(){var e=A["export"]("pico/str"),r="undefined"==typeof t?JSON.stringify:t("util").inspect;return{ensure:function(t,n){n(function(n,i){return n?console.error(t+":"+e.tab(t,100,"-")+n):void console.log(t+":"+e.tab(t,100,".")+r(i,{colors:!0}))})}}}),I("pico/time",function(){var e=Math.max,r=Math.min,t=Math.floor,n=Math.ceil,i=864e5,o=36e5,u=6e4,a=1e3,s=function(e,r){return(e-r)/i},c=function(e,r,t){var i=r?1:0,o=new Date(e.getFullYear()+(t||0),0,1),u=(7-o.getDay())%7+i,a=s(e,o);return a>u?n((a-u)/7):c(e,r,-1)},l=function(e,r,t){var n=e.split("/"),i=n[0];if("*"===i)n[0]=r;else if(i=n[0]=parseInt(i),r>i||i>t)return;return 1===n.length?n.push(0):n[1]=parseInt(n[1]),n},f=function(e,r,t){if("*"===e)return 0;var n=[];list=e.split(",");for(var i,o,u,a,s,c,f,p=0;i=list[p];p++){if(u=i.split("-"),!u.length)return null;if(a=l(u[0],r,t),1!==u.length)if(s=l(u[1],r,t),o=a[0],c=s[0],f=s[1]||1,o>c){for(c=t;c>=o;o+=f)n.push(o);for(o=r,c=s[0];c>=o;o+=f)n.push(o)}else for(;c>=o;o+=f)n.push(o);else if(f=a[1])for(o=a[0];t>=o;o+=f)n.push(o);else n.push(a[0])}return n.sort(function(e,r){return e-r}),n},p=function(t,n,i){if(!n)return t;if(e.apply(Math,n.concat(t))===t)return t+(i-t)+r.apply(Math,n);for(var o=0,u=n.length;u>o;o++)if(n[o]>=t)return n[o];console.error("not suppose to be here",t,n,i)},h=function(e,r,n,a,s,c,l,f,d){if(r++>1)return d(0);var g=p(e.getMinutes(),n,60),v=p(e.getHours()+t(g/60),a,24),m=e.getDate(),y=e.getMonth(),b=e.getFullYear(),S=new Date(b,y,0).getDate();if(l){var k=e.getDay()+t(v/24),w=p(k,l,7);m+=w-k}else m=p(m+t(v/24),s,S);if(y=p(y+1+t(m/S),c,12),e.getMonth()+1!==y)return h(new Date(b,y-1),r,n,a,s,c,l,f,d);if(b=p(b+t((y-1)/12),f,0),e.getFullYear()!==b)return h(new Date(b,y-1),r,n,a,s,c,l,f,d);var x=new Date(b,(y-1)%12).getTime();return x+=(m%S-1)*i,x+=v%24*o,x+=g%60*u,d(x)};return{deltaToNext:function(e,r,t,n,i){var s=new Date,c=s.getTime()%o-((t||0)*u+(n||0)*a+(i||0)),l=(r||0)+24*e-s.getHours();return l*o-c},timeOfNext:function(e,r,t,n,i){return new Date(Date.now()+this.deltaToNext(e,r,t,n,i)).getTime()},parse:function(e){var r=e.split(" ");if(r.length<6)return 0;var t=f(r[0],0,59);if(null==t)return 0;var n=f(r[1],0,23);if(null==n)return 0;var i=f(r[2],1,31);if(null==i)return 0;var o=f(r[3],1,12);if(null==o)return 0;var u=f(r[4],0,6);if(null==u)return 0;var a=f(r[5],1975,2075);return null==a?0:[t,n,i,o,u,a]},nearest:function(e,r,t,n,i,o){var a=new Date,s=p(a.getFullYear(),o,0),c=p(a.getMonth()+1,n,12)-1;if(a.getFullYear()!==s||a.getMonth()!==c)a=new Date(s,c);else{var l=a.getTime();a=new Date(l+u)}return h(a,0,e,r,t,n,i,o,function(e){return e})},daynum:s,weeknum:c,day:function(e,r){var t=new Date,n=new Date(t.getFullYear(),t.getMonth(),t.getDate(),12,0,0),o=n-e,u=1.5*i;return o>=0&&u>=o||0>=o&&o>-u?t.getDate()===e.getDate()?"Today":t>e?"Yesterday":"Tomorrow":(r=r||"en-US",t.getFullYear()===e.getFullYear()&&c(t)===c(e)?e.toLocaleDateString(r,{weekday:"long"}):e.toLocaleDateString(r,{weekday:"short",month:"short",day:"numeric"}))}}}),I("pico/web",function(e,r,t,i,o,u){function a(e){return e.url?(w(this,e),this.reqId=1+l(1e3*f()),this.inbox=[],this.outbox=[],this.uploads=[],this.callbacks={},this.acks=[],this.reqs=[],this.resEndPos=0,this.head=null,this.body=[],this.currPT=h,this.serverTime=0,void(this.serverTimeAtClient=0)):console.error("url is not set")}var s=r("pico/json"),c=Math.abs,l=Math.floor,f=Math.random,p="ack",h=1,d=2,g=!0,v=function(e){e&&console.error(e)},m=function(e,r,t){e.append(r,t)},y=function(e,r,t){e[r]=t},b=function(e,r){r=r||v,n("get",e.url,null,null,function(t,n,i){if(4===n){if(t)return r(t);var o=parseInt(i);if(isNaN(o))return r("invalid timesync response");e.serverTime=o,e.serverTimeAtClient=Date.now(),r()}})},S=function(e,r,t,n){if(e){if(4!==r)return;var i,o;if(t){try{i=JSON.parse(t).reqId}catch(u){return console.error(u)}return o=n.callbacks[i],void(o&&(delete n.callbacks[i],o(e)))}for(var a,l=n.reqs,f=n.delimiter,g=0,v=l.length;v>g;g++)if(a=l[g]){try{i=JSON.parse(a.split(f)[0]).reqId}catch(u){console.error(u);continue}o=n.callbacks[i],o&&(delete n.callbacks[i],o(e))}return l.length=0,b(n)}switch(r){case 2:n.head=null,n.currPT=h,n.resEndPos=0;break;case 3:break;case 4:}var m,y=n.resEndPos,S=-1,f=n.delimiter,k=f.length,w=n.body;try{for(;;){if(S=t.indexOf(f,y),-1===S)break;switch(n.currPT){case h:n.head=JSON.parse(t.substring(y,S)),w.length=0,n.currPT=d;break;case d:w.push(t.substring(y,S))}if(m=n.head,m&&m.len===w.length){if(n.currPT=h,m.resId&&n.request(p,{resId:m.resId}),!m.reqId)return void console.error("incomplete response header: "+JSON.stringify(m));if(n.cullAge&&n.cullAge<c(n.getServerTime()-m.date))return void console.error("invalid server time: "+JSON.stringify(m)+" "+c(n.getServerTime()-m.date));if(n.secretKey&&w.length){for(var x=CryptoJS.algo.HMAC.create(CryptoJS.algo.MD5,n.secretKey+m.date),g=0,v=w.length;v>g;g++)x.update(w[g]);if(m.key!==x.finalize().toString(CryptoJS.enc.Base64))return void console.error("invalid server key: "+JSON.stringify(m))}m.len&&(m.data=s.parse(w,!0)),n.inbox.push(m),n.head=null}y=S+k}}catch(u){console.error(u)}n.resEndPos=y},k=function(e,r,t,n){n=n||"";for(var i,o,u,a,s=t instanceof FormData?m:y,c=e.baseURI,l=0,f=e.elements;a=f[l];l++)if(a.hasAttribute("name"))if(i=a.hasAttribute("type")?a.getAttribute("type").toUpperCase():"TEXT","FILE"===i)for(o=0,u=a.files.length;u>o;s(t,n+a.name,a.files[o++]));else("RADIO"!==i&&"CHECKBOX"!==i||a.checked)&&s(t,n+a.name,a.value);for(var p in r)s(t,n+p,r[p]);return c=c.substring(0,c.lastIndexOf("/")+1),e.action.substr(c.length)},w=function(e,r){e.url=r.url||e.url,e.secretKey=r.secretKey||e.secretKey,e.cullAge=r.cullAge||e.cullAge||0,e.delimiter=r.delimiter?JSON.stringify(r.delimiter):e.delimiter||JSON.stringify(["&"])},x=function(e){e.resEndPos=e.outbox.length=e.acks.length=0,e.currPT=h};return a.prototype={beat:function(){if(this.inbox.length)for(var e,r,t,i=this.inbox,o=this.callbacks;t=i.pop();)e=t.reqId,r=o[e],r&&(delete o[e],r(t.error,t.data));if(g&&(this.uploads.length||this.outbox.length||this.acks.length)){var u=this.uploads,a=this.outbox,s=this.acks;if(u.length)n("post",this.url,u.shift(),null,S,this);else{var c=this.reqs=s.concat(a);s.length=a.length=0,n("post",this.url,c.join(this.delimiter)+this.delimiter,null,S,this)}}},reconnect:function(e,r){w(this,e),x(this),b(this,function(e){r(e,this)})},submit:function(e,r,t){if(!("undefined"!=typeof window&&e&&e instanceof HTMLFormElement))return console.error("No HTMLFormElement submitted");var n=0;t&&(n=this.reqId++,this.callbacks[n]=t);var i=new FormData;i.append("api",k(e,r,i,"data/")),i.append("reqId",n),this.uploads.push(i)},request:function(e,r,t,n){switch(arguments.length){case 2:r instanceof Function&&(n=r,r=t=void 0);break;case 3:t instanceof Function&&(n=t,t=void 0);break;case 4:break;default:return console.error("wrong request params!")}if("undefined"!=typeof window&&r instanceof HTMLFormElement){var i={};e=k(r,t,i),r=i}else if(t)for(var o in t)r[o]=t[o];if(!e)return console.error("Missing api,  data["+JSON.stringify(r)+"]");var u=this.acks;if(e!==p&&(u=this.outbox,u.length)){var a=u.shift();-1===a.indexOf(e)&&u.unshift(a)}var c=0;n&&(c=this.reqId++,this.callbacks[c]=n);var l=r?s.stringify(r,!0):[];if(l.length&&this.secretKey){for(var f=this.getServerTime(),h=CryptoJS.algo.HMAC.create(CryptoJS.algo.MD5,this.secretKey+f),d=0,g=l.length;g>d;d++)h.update(l[d]);l.unshift(JSON.stringify({api:e,reqId:c,len:l.length,date:f,key:h.finalize().toString(CryptoJS.enc.Base64)}))}else l.unshift(JSON.stringify({api:e,reqId:c,len:l.length}));u.push(l.join(this.delimiter))},getServerTime:function(){return this.serverTime+(Date.now()-this.serverTimeAtClient)}},{create:function(e,r){var t=new a(e);b(t,function(e){r(e,t)})},ajax:n,online:function(){g=!0},offline:function(){g=!1}}})}).apply(null,"undefined"==typeof window?[module,"exports",require]:[window,"pico"]);
//# sourceMappingURL=/opt/pico/common/pico.min.js.map